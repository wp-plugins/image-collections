function cancelEvent(){return false}function getTopPos(e){var t=e.offsetTop;while((e=e.offsetParent)!=null){if(e.tagName!="HTML"){t+=e.offsetTop-e.scrollTop;if(document.all)t+=e.clientTop}}return t}function getLeftPos(e){var t=e.offsetLeft;while((e=e.offsetParent)!=null){if(e.tagName!="HTML"){t+=e.offsetLeft;if(document.all)t+=e.clientLeft}}return t}function selectImage(e){if(document.all&&!operaBrowser)e=event;var t=this.parentNode;if(activeImage)activeImage.className="imageBox";t.className="imageBoxHighlighted";activeImage=t;readyToMove=true;moveTimer=0;tmpLeft=e.clientX+Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);tmpTop=e.clientY+Math.max(document.body.scrollTop,document.documentElement.scrollTop);startMoveTimer();return false}function startMoveTimer(){if(moveTimer>=0&&moveTimer<10){moveTimer++;setTimeout("startMoveTimer()",15)}if(moveTimer==10){getDivCoordinates();var e=dragDropDiv.getElementsByTagName("DIV");if(e.length>0){dragDropDiv.removeChild(e[0])}jQuery("#dragDropContent").show();var t=activeImage.cloneNode(true);t.className="imageBox";t.id="";jQuery("#dragDropContent").append(t);jQuery("#dragDropContent").css("top",tmpTop-eventDiff_y+"px");jQuery("#dragDropContent").css("left",tmpLeft-eventDiff_x+"px")}return false}function dragDropEnd(e){readyToMove=false;moveTimer=-1;jQuery("#dragDropContent").hide();jQuery("#insertionMarker").hide();if(destinationObject&&destinationObject!=activeImage){var t=destinationObject.parentNode;t.insertBefore(activeImage,destinationObject);activeImage.className="imageBox";activeImage=false;destinationObject=false;getDivCoordinates()}return false}function dragDropMove(e){if(moveTimer==-1)return;if(document.all&&!operaBrowser)e=event;if(webkitBrowser){var t=e.pageX-eventDiff_x;var n=e.pageY-eventDiff_y}else{var t=e.clientX+document.documentElement.scrollLeft-eventDiff_x;var n=e.clientY+document.documentElement.scrollTop-eventDiff_y}dragDropDiv.style.top=n+"px";dragDropDiv.style.left=t+"px";t=t+eventDiff_x;n=n+eventDiff_y;if(e.button!=1&&document.all&&!operaBrowser)dragDropEnd(e);var r=false;for(var i in divXPositions){if(divXPositions[i]/1<t/1&&divXPositions[i]/1+divWidth[i]*.7>t/1&&divYPositions[i]/1<n/1&&divYPositions[i]/1+divWidth[i]>n/1){jQuery("#insertionMarker").css("top",divYPositions[i]+offsetY+"px");jQuery("#insertionMarker").css("left",divXPositions[i]+offsetX+"px");jQuery("#insertionMarker").show();destinationObject=document.getElementById(i);r=true;break}}if(!r){jQuery("#insertionMarker").hide();destinationObject=false}return false}function $$(e,t){return jQuery(e.replace(/(\[|\])/g,"\\$1"),t)}function getDivCoordinates(){var e=document.getElementsByTagName("div");for(var t=0;t<e.length;t++){if(e[t].className=="imageBox"||e[t].className=="imageBoxHighlighted"&&e[t].id){divXPositions[e[t].id]=getLeftPos(e[t]);divYPositions[e[t].id]=getTopPos(e[t]);divWidth[e[t].id]=e[t].offsetWidth;divHeight[e[t].id]=e[t].offsetHeight}}}function saveImageOrder(){var e="";var t=document.getElementsByTagName("div");for(var n=0;n<t.length;n++){if(t[n].className=="imageBox"||t[n].className=="imageBoxHighlighted"){if(e.length>0)e=e+"&";e=e+"sortArray[]="+t[n].id}}jQuery("input[name=sortorder]").val(e)}function initGallery(){var e=document.getElementsByTagName("div");for(var t=0;t<e.length;t++){if(e[t].className=="imageBox_theImage"||e[t].className=="imageBox_label"){e[t].onmousedown=selectImage}}var n=document.getElementById("insertionMarker");var r=n.getElementsByTagName("IMG");document.body.onselectstart=cancelEvent;document.body.ondragstart=cancelEvent;document.body.onmouseup=dragDropEnd;document.body.onmousemove=dragDropMove;window.onresize=getDivCoordinates;dragDropDiv=document.getElementById("dragDropContent");jQuery("#insertionMarker").hide();getDivCoordinates();var i=document.getElementsByClassName("imageBox");var s=i[0].parentNode;var o=i[i.length-1];var u=document.createElement("div");u.className="imageBox";u.id="foo";u.style.cssText="visibility:hidden";if(o.nextSibling){s.insertBefore(u,o.nextSibling)}else{s.appendChild(u)}}function debug(e){document.getElementById("debug").innerHTML=e}var operaBrowser=navigator.userAgent.indexOf("Opera")>=0?1:false;var webkitBrowser=navigator.userAgent.indexOf("Safari")>=0?false:false;var MSIE=navigator.userAgent.indexOf("MSIE")>=0?true:false;var navigatorVersion=navigator.appVersion.replace(/.*?MSIE (\d\.\d).*/g,"$1")/1;var activeImage=false;var readyToMove=false;var moveTimer=-1;var dragDropDiv;var insertionMarker;var destinationObject=false;var divXPositions=new Array;var divYPositions=new Array;var divWidth=new Array;var divHeight=new Array;var tmpLeft=0;var tmpTop=0;var eventDiff_x=160;var eventDiff_y=10;var offsetX=0;var offsetY=-23;var imgsSCntr="";var iMarker="";var tmpLT="";jQuery(function(e){imgsSCntr=e("#abcficSortCntr");iMarker=e("#iMarker");tmpLT=e("#tmpLT");var t=e("#cntrOffset");var n=imgsSCntr.offset();offsetX=-(n.left+3);t.html("imgsCntr L: "+n.left+", imgsCntr T: "+n.top)});window.onload=initGallery